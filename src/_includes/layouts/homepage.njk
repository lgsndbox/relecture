---
layout: layouts/base.njk
---

{% set currentTheme = themes | getCurrentTheme %}

<div class="homepage">
    <div class="homepage-spotlight">
    {% if currentTheme %}
    {# Articles from current theme #}
    {% set themeArticles = collections.articlesByTheme | getArticlesByTheme(currentTheme.slug) %}

    {# Process theme articles using shared filter #}
    {% set processed = themeArticles | processThemeArticles %}
    {% set editorialArticle = processed.editorial %}
    {% set mainArticle = processed.main %}
    {% set regularArticles = processed.regular %}

    <section class="current-theme-card">
        <div class="theme-card__header">
            <div class="theme-card__number">{{ "theme.number" | t }} {{ currentTheme.number }}</div>
            <div class="theme-card__label">{{ currentTheme.name }}</div>
        </div>

        <div class="theme-card__main">
            <div class="theme-card__left">
                {% if mainArticle %}
                <div class="theme-card__article-featured">
                    <span class="badge badge--text badge--sm">{{ "badges.featured" | t }}</span>
                    {% if mainArticle.data.image %}
                    <div class="theme-card__image">
                        {% image mainArticle.data.image, mainArticle.data.imageAlt or mainArticle.data.title, "(min-width: 768px) 40vw, 100vw" %}
                    </div>
                    {% endif %}

                    <a href="{{ mainArticle.url }}" class="article-item-link">
                        {{ mainArticle.data.title }}
                    </a>
                    {% if mainArticle.data.author %}
                    <span class="article-item-author">{{ mainArticle.data.author }}</span>
                    {% endif %}
                </div>
                {% endif %}
                {% if currentTheme.image %}
                <div class="theme-card__image">
                    {% image currentTheme.image, currentTheme.imageAlt or currentTheme.name, "(min-width: 768px) 40vw, 100vw" %}
                </div>
                {% endif %}

                

                <div class="theme-card__actions">
                    <a href="/themes/{{ currentTheme.slug }}/" class="btn btn--primary btn--block">{{ "theme.viewTheme" | t }}</a>
                </div>

            </div>
            <div class="theme-card__content">
                <div class="theme-card__title-section">
                    <p class="theme-card__date">{{ currentTheme.month }} {{ currentTheme.year }}</p>
                    <h2 class="theme-card__title">
                        <a href="/themes/{{ currentTheme.slug }}/" class="theme-card__title-link">{{ currentTheme.name }}</a>
                    </h2>
                    {% if currentTheme.chapeau %}
                    <p class="theme-card__chapeau">{{ currentTheme.chapeau }}</p>
                    {% endif %}
                    {% if currentTheme.introduction %}
                    <div class="theme-card__introduction">
                        <p>{{ currentTheme.introduction }}</p>
                    </div>
                    {% endif %}
                </div>

                {% if themeArticles.length > 0 %}
                <div class="theme-card__articles">
                    <h2 class="theme-card__articles-title">{{ "theme.articlesOfTheme" | t }}</h2>
                    <ul class="theme-card__articles-list">
                        {# Editorial first #}
                        {% if editorialArticle %}
                        <li class="theme-card__article-item editorial">
                            <span class="badge badge--text badge--sm">{{ "badges.editorial" | t }}</span>
                            <a href="{{ editorialArticle.url }}" class="article-item-link">
                                {{ editorialArticle.data.title }}
                            </a>
                            {% if editorialArticle.data.author %}
                            <span class="article-item-author">{{ editorialArticle.data.author }}</span>
                            {% endif %}
                        </li>
                        {% endif %}

                        {# Main article #}
                        

                        {# Other articles (show 4 most recent) #}
                        {% set displayArticles = regularArticles | reverse | slice(0, 4) %}
                        {% for article in displayArticles %}
                        <li class="theme-card__article-item">
                            <a href="{{ article.url }}" class="article-item-link">
                                {{ article.data.title }}
                            </a>
                            {% if article.data.author %}
                            <span class="article-item-author">{{ article.data.author }}</span>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

            </div>
        </div>
    </section>
    {% else %}
    <section class="hero-current-theme">
        <h1>{{ "common.welcome" | t }}</h1>
        <p>{{ "theme.noCurrentTheme" | t }}</p>
    </section>
    {% endif %}

    {# Independent articles section #}
    {% if collections.featuredArticles and collections.featuredArticles.length > 0 %}
    <section class="independent-articles-card">
        <div class="independent-card__header">
            <div class="independent-card__label">{{ "nav.standalone" | t }}</div>
            <div class="independent-card__count">{{ collections.featuredArticles.length }} {{ "common.article" if collections.featuredArticles.length == 1 else "common.articles" | t }}</div>
        </div>

        <div class="independent-card__main">
            <div class="independent-card__intro">
                <p>{{ "article.independentDescription" | t }}</p>
            </div>

            <div class="independent-articles-list">
                {% for article in collections.featuredArticles %}
                <article class="independent-article__item">
                    {% if article.data.image %}
                    <div class="independent-article__image">
                        <a href="{{ article.url }}">
                            {% image article.data.image, article.data.imageAlt or article.data.title, "(min-width: 768px) 20vw, 100vw" %}
                        </a>
                    </div>
                    {% endif %}

                    <div class="independent-article__content">
                        {% set articleThemeData = themes | getThemeBySlug(article.data.theme) %}
                        {% if article.data.theme and articleThemeData %}
                        <div class="independent-article__theme">
                            <span class="theme-label">{{ "theme.themePrefix" | t }} {{ articleThemeData.number }}: {{ articleThemeData.name }}</span>
                        </div>
                        {% endif %}

                        <h3 class="independent-article__title">
                            <a href="{{ article.url }}">{{ article.data.title }}</a>
                        </h3>

                        {% if article.data.chapeau %}
                        <p class="independent-article__chapeau">{{ article.data.chapeau }}</p>
                        {% endif %}

                        <div class="independent-article__meta">
                            {% if article.data.author %}
                            <span class="meta-author">{{ article.data.author }}</span>
                            {% endif %}
                            {% if article.data.author and article.data.date %}
                            <span class="meta-separator" aria-hidden="true">Â·</span>
                            {% endif %}
                            {% if article.data.date %}
                            <time datetime="{{ article.data.date | isoDate }}" class="meta-date">{{ article.data.date | formatDate }}</time>
                            {% endif %}
                        </div>
                    </div>
                </article>
                {% endfor %}
            </div>

            <div class="independent-card__actions">
                <a href="/standalone/" class="btn btn--primary btn--block">{{ "article.viewAllIndependent" | t }}</a>
            </div>
        </div>
    </section>
    {% endif %}

    {# Call to action to explore all themes #}
    <section class="explore-themes-cta">
        <h2>{{ "theme.discoverThemes" | t }}</h2>
        <p>{{ "theme.discoverDescription" | t }}</p>
        <a href="/themes/" class="btn btn--primary btn--lg">{{ "theme.viewAllThemes" | t }}</a>
    </section>
    </div>
</div>
